<!DOCTYPE html>

<head>
  <link rel="stylesheet" href="css/my.css" />

  <script src="js/leaflet/leaflet-src.js"></script>
  <link rel="stylesheet" href="js/leaflet/leaflet.css" />

  <script src="js/leaflet/plugins/leaflet.hotline.js"></script>

  <script src="js/map.js"></script>
  <script src="data/data.js"></script>

  <script src="data/data.m2.going_home.js"></script>
  <script src="data/data.m2.going_work.js"></script>
  <script src="data/data.xz1.going_home.js"></script>
  <script src="data/data.xz1.going_work.js"></script>
  <script src="data/data.xz1.lunch.js"></script>

  <!-- <script src="data/index.js"></script> -->

  <script src="js/calc.js"></script>
  <script src="js/svy21.js"></script>
  <script src="js/main.js"></script>

</head>

<html>
  <body>
    <!-- <div id="mapid"></div> -->
    <div
      id="mapdiv"
      style="width: 700px; height: 700px; position: relative;"
      class="leaflet-container leaflet-retina leaflet-fade-anim leaflet-grab leaflet-touch-drag"
      tabindex="0"
    ></div>

    <script>
      var map = setupMap();
      var locationData = {};

      /* data sets:
      m2GoHome
      m2GoWork
      xz1GoLunch aka data
      xz1GoHome
      xz1GoWork
      */
      var datasetToUse = data
      //backward compatibility due to change in data format
      if (datasetToUse[0].location) {
        locationData = datasetToUse.map(item => { return item.location});
      } else {
        locationData = datasetToUse;
      }


      locationData.sort((p1, p2) => {
        return p1.recordedTime > p2.recordedTime;
      });

      //plot path
      var coords = [];
      locationData.forEach(location => {
        var loc = [location.latitude, location.longitude];
        coords.push(loc);
      });
      console.log(coords.length + " points captured");
      // var polyline = L.polyline(coords).addTo(map);

      var bounds = new L.LatLngBounds(coords);
      map.fitBounds(bounds);

      var speedLayer = createSpeedLayer(locationData)
      speedLayer.addTo(map)

      // var altitudeLayer = createAltitudeLayer(locationData)
      // altitudeLayer.addTo(map)      

    </script>
  </body>
</html>
