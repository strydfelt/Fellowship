<!DOCTYPE html>

<head>
  <link rel="stylesheet" href="css/my.css" />

  <script src="js/leaflet/leaflet-src.js"></script>
  <link rel="stylesheet" href="js/leaflet/leaflet.css" />

  <script src="js/leaflet/plugins/leaflet.hotline.js"></script>

  <script src="js/map.js"></script>
  <script src="data/data.js"></script>

  <script src="data/data.m2.going_home.js"></script>
  <script src="data/data.m2.going_work.js"></script>
  <script src="data/data.xz1.going_home.js"></script>
  <script src="data/data.xz1.going_work.js"></script>
  <script src="data/data.xz1.lunch.js"></script>

  <!-- <script src="data/index.js"></script> -->

  <script src="js/calc.js"></script>
  <script src="js/svy21.js"></script>
  <script src="js/main.js"></script>
</head>

<html>
  <body>
    <!-- <div id="mapid"></div> -->
    <div
      id="mapdiv"
      style="width: 600px; height: 600px; position: relative;"
      class="leaflet-container leaflet-retina leaflet-fade-anim leaflet-grab leaflet-touch-drag"
      tabindex="0"
    ></div>

    <script>
      //data prep
      var locationData = {};

      /* data sets:
      m2GoHome
      m2GoWork
      xz1GoLunch aka data
      xz1GoHome
      xz1GoWork
      */
      var datasetToUse = data;
      //backward compatibility due to change in data format
      if (datasetToUse[0].location) {
        locationData = datasetToUse.map(item => {
          return item.location;
        });
      } else {
        locationData = datasetToUse;
      }

      locationData.sort((p1, p2) => {
        return p1.recordedTime > p2.recordedTime;
      });

      //overlays

      //plot path
      var coords = [];
      locationData.forEach(location => {
        var loc = [location.latitude, location.longitude];
        coords.push(loc);
      });
      console.log(coords.length + " points captured");


      //map tile sets
      var osm = osmTiles();
      var mapbox = mapboxTiles();
      var onemap = onemapTiles();
      var mapTileSetLayers = [osm, mapbox, onemap];

      var center = L.bounds([1.56073, 104.11475], [1.16, 103.502]).getCenter();

      var mapLayers = {
        OSM: osm,
        MapBox: mapbox,
        OneMap: onemap
      };


      //layers
      var pathLayer = createPathLayer(locationData);
      var speedLayer = createSpeedLayer(locationData);
      var altitudeLayer = createAltitudeLayer(locationData);

      var layersAvailable = [pathLayer, speedLayer, altitudeLayer];
      var pathLayerGroup = L.layerGroup(layersAvailable);

      var overlayMaps = {
        Path: pathLayer,
        Speed: speedLayer,
        Altitude: altitudeLayer
      };      

      var overlayMaps = {
        Path: pathLayer,
        Speed: speedLayer,
        Altitude: altitudeLayer
      };


      var map = L.map("mapdiv", {
        layers: mapTileSetLayers
      }).setView([center.x, center.y], 12);


      L.control.layers(mapLayers, overlayMaps).addTo(map);

      var bounds = new L.LatLngBounds(coords);
      map.fitBounds(bounds);
    </script>
  </body>
</html>
